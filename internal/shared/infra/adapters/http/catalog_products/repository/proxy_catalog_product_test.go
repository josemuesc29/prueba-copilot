package repository

import (
	"ftd-td-catalog-item-read-services/cmd/config"
	mocks_server "ftd-td-catalog-item-read-services/test/mocks/server"
	"github.com/gin-gonic/gin"
	"github.com/stretchr/testify/assert"
	"go.uber.org/mock/gomock"
	"net/http"
	"net/http/httptest"
	"net/url"
	"testing"
)

const (
	responseOKCatalogProducts            = "{\n    \"deliveryTime\": \"35 min. promedio\",\n    \"labelPum\": \"Gramos a $\",\n    \"measurePum\": 48,\n    \"listUrlImages\": [\n        \"https://lh3.googleusercontent.com/YlFFxbzrydDnAhYXPad4LeVaJIS0rUesFdGGebQuDohRwXZszjhVX3RisyNYCCyTLPzaO-KCCqwMsogR6StzJi0fxr5P7dCGMAs7IHfrAam-aLzU\",\n        \"https://lh3.googleusercontent.com/iqZJjNBXcZf10ry3d2Jcm7BE3wt4N5pfM4nRImmI9HIFgKlUnhGL2dmAPvLXIftW7ebFfKfUsl_id-AarKy05WOtAEq2EZcDVN0t8T7SQU-zGBbg\",\n        \"https://lh3.googleusercontent.com/_5oF3ED1Dww6L-EzMC_OmrcSEFRcsxKx4zepkWFACQHjl0agAdf1dyR3spkEqZO2gT5O0ksxOnciRv3V-EGaFkiKAjD3EtfU_RvR5S3uquAKGkBX\",\n        \"https://lh3.googleusercontent.com/I5RlivL-BbQGAqxwPlv1c9o7IzSp-Loj07xK8jp9y3vktNCoVldb_exrIdbYa0IlV4sFs99ur9MYf_98VLGNSc4PHf_p1hu3Ej6ZAEFBNprxkYnc\",\n        \"https://lh3.googleusercontent.com/A6mkZoDcye3kJFywIN7ez9evNk8DMRgOg713jMicJ-9K6cigJvM4MvgR-U3WvMwB3dcGIbeDvwogNj9Fr5rSoaSNFZXsFs4VWcRk03tYis-j0iig\"\n    ],\n    \"outofstore\": false,\n    \"onlyOnline\": false,\n    \"marca\": \"Cetaphil\",\n    \"mediaImageUrl\": \"https://lh3.googleusercontent.com/4lhwm7XEzD6MZquvwnXR9qb2FgdW_IDS9uI3Bem78wVNCjqgPnM_KudM_M5Tvc46-tzxyaTwyYyXORw6Hb9qAoyuAwcstinPnD22-hUIBsFLrEzWNw\",\n    \"barcodeList\": [\n        \"263550021\",\n        \"3499320014540\",\n        \"03499320014540\"\n    ],\n    \"rms_deparment\": \"CUIDADO DE LA PIEL DERMOCOSMET\",\n    \"rms_class\": \"CUIDADO FACIAL DERMOCOSMETICOS\",\n    \"rms_group\": \"DERMOCOSMETICOS\",\n    \"rms_subclass\": \"CUIDADO FACIAL DERMOCOSMETICOS\",\n    \"fullPrice\": 148950,\n    \"sales\": 418,\n    \"classification\": [\n        {\n            \"id\": 611,\n            \"name\": \"Dermocosmética\",\n            \"typeId\": 1,\n            \"typeName\": \"DEPARTAMENTO\"\n        },\n        {\n            \"id\": 612,\n            \"name\": \"Facial\",\n            \"typeId\": 2,\n            \"typeName\": \"CATEGORIA\"\n        },\n        {\n            \"id\": 616,\n            \"name\": \"Hidratantes faciales\",\n            \"typeId\": 3,\n            \"typeName\": \"SUBCATEGORIA\"\n        }\n    ],\n    \"brand\": \"2008M-0008623\",\n    \"categorie\": \"Facial\",\n    \"departments\": [\n        \"Dermocosmética\"\n    ],\n    \"taxRate\": 19,\n    \"subCategory\": \"Hidratantes faciales\",\n    \"barcode\": \"3499320014540\",\n    \"mediaDescription\": \"Gel Hidratante Cetaphil Facial Water Gel x 48 gr\",\n    \"largeDescription\": \"Gel Hidratante Facial Cetaphil Water Gel brinda a la piel una hidratación intensa y prolonagada durante 72 horas. Ideal para todo tipo de pieles incluidas las mixtas y grasa.\",\n    \"stores_with_stock\": [\n        22,\n        1\n    ],\n    \"id_highlights\": [\n        51933,\n        52276\n    ],\n    \"offerPrice\": 111712.5,\n    \"offerText\": \"25%\",\n    \"offerDescription\": \"¡Aprovecha!\",\n    \"stores_with_offer\": [\n        26,\n        80\n    ],\n    \"id\": \"263550021\",\n    \"primePrice\": 104265,\n    \"primeTextDiscount\": \"30%\",\n    \"primeDescription\": \"¡Aprovecha!\",\n    \"Prime\": \"si\",\n    \"stores_with_prime_offer\": [\n        26,\n        80\n    ],\n    \"id_suggested\": [\n        24611\n    ],\n    \"fullPriceByCity\": [\n        {\n            \"cityCode\": \"VVC\",\n            \"fullPrice\": 148950\n        }\n    ],\n    \"idOffersGroup\": [\n        52088\n    ],\n    \"offerStartDate\": 1746075600000,\n    \"offerEndDate\": 1746507540000,\n    \"lastUpdate\": {\n        \"jobName\": \"UPDATE_SUGGEST\",\n        \"timeStamp\": 1747263900270\n    },\n    \"supplier\": \"GALDERMA MASIVO\",\n    \"grayDescription\": \" \",\n    \"highlight\": \"false\",\n    \"requirePrescription\": \"false\",\n    \"anywaySelling\": false,\n    \"is_cupon\": 0,\n    \"genericos\": 0,\n    \"spaces\": 1,\n    \"url\": \"263550021-crema-facial-cetaphil\",\n    \"status\": \"A\",\n    \"offerPriceByCity\": [],\n    \"RMS_PROVIDER\": \"GALDERMA MASIVO\",\n    \"metatituloSEO\": null,\n    \"metadesSEO\": null,\n    \"urlCanonical\": null,\n    \"customTag\": null,\n    \"desHiddenSEO\": null,\n    \"customLabelForStockZeroByCity\": [\n        {\n            \"cityCode\": \"BOG\",\n            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n        }\n    ],\n    \"_collections\": [\n        \"Test\"\n    ],\n    \"objectID\": \"263550021\"\n}"
	responseOKCatalogProductsByObjectsID = "{\n    \"results\": [\n        {\n            \"deliveryTime\": \"35 min. promedio\",\n            \"labelPum\": \"Gramos a $\",\n            \"measurePum\": 48,\n            \"listUrlImages\": [\n                \"https://lh3.googleusercontent.com/YlFFxbzrydDnAhYXPad4LeVaJIS0rUesFdGGebQuDohRwXZszjhVX3RisyNYCCyTLPzaO-KCCqwMsogR6StzJi0fxr5P7dCGMAs7IHfrAam-aLzU\",\n                \"https://lh3.googleusercontent.com/iqZJjNBXcZf10ry3d2Jcm7BE3wt4N5pfM4nRImmI9HIFgKlUnhGL2dmAPvLXIftW7ebFfKfUsl_id-AarKy05WOtAEq2EZcDVN0t8T7SQU-zGBbg\",\n                \"https://lh3.googleusercontent.com/_5oF3ED1Dww6L-EzMC_OmrcSEFRcsxKx4zepkWFACQHjl0agAdf1dyR3spkEqZO2gT5O0ksxOnciRv3V-EGaFkiKAjD3EtfU_RvR5S3uquAKGkBX\",\n                \"https://lh3.googleusercontent.com/I5RlivL-BbQGAqxwPlv1c9o7IzSp-Loj07xK8jp9y3vktNCoVldb_exrIdbYa0IlV4sFs99ur9MYf_98VLGNSc4PHf_p1hu3Ej6ZAEFBNprxkYnc\",\n                \"https://lh3.googleusercontent.com/A6mkZoDcye3kJFywIN7ez9evNk8DMRgOg713jMicJ-9K6cigJvM4MvgR-U3WvMwB3dcGIbeDvwogNj9Fr5rSoaSNFZXsFs4VWcRk03tYis-j0iig\"\n            ],\n            \"outofstore\": false,\n            \"onlyOnline\": false,\n            \"marca\": \"Cetaphil\",\n            \"mediaImageUrl\": \"https://lh3.googleusercontent.com/4lhwm7XEzD6MZquvwnXR9qb2FgdW_IDS9uI3Bem78wVNCjqgPnM_KudM_M5Tvc46-tzxyaTwyYyXORw6Hb9qAoyuAwcstinPnD22-hUIBsFLrEzWNw\",\n            \"barcodeList\": [\n                \"263550021\",\n                \"3499320014540\",\n                \"03499320014540\"\n            ],\n            \"rms_deparment\": \"CUIDADO DE LA PIEL DERMOCOSMET\",\n            \"rms_class\": \"CUIDADO FACIAL DERMOCOSMETICOS\",\n            \"rms_group\": \"DERMOCOSMETICOS\",\n            \"rms_subclass\": \"CUIDADO FACIAL DERMOCOSMETICOS\",\n            \"fullPrice\": 148950,\n            \"sales\": 418,\n            \"classification\": [\n                {\n                    \"id\": 611,\n                    \"name\": \"Dermocosmética\",\n                    \"typeId\": 1,\n                    \"typeName\": \"DEPARTAMENTO\"\n                },\n                {\n                    \"id\": 612,\n                    \"name\": \"Facial\",\n                    \"typeId\": 2,\n                    \"typeName\": \"CATEGORIA\"\n                },\n                {\n                    \"id\": 616,\n                    \"name\": \"Hidratantes faciales\",\n                    \"typeId\": 3,\n                    \"typeName\": \"SUBCATEGORIA\"\n                }\n            ],\n            \"brand\": \"2008M-0008623\",\n            \"categorie\": \"Facial\",\n            \"departments\": [\n                \"Dermocosmética\"\n            ],\n            \"taxRate\": 19,\n            \"subCategory\": \"Hidratantes faciales\",\n            \"barcode\": \"3499320014540\",\n            \"mediaDescription\": \"Gel Hidratante Cetaphil Facial Water Gel x 48 gr\",\n            \"largeDescription\": \"Gel Hidratante Facial Cetaphil Water Gel brinda a la piel una hidratación intensa y prolonagada durante 72 horas. Ideal para todo tipo de pieles incluidas las mixtas y grasa.\",\n            \"stores_with_stock\": [\n                22,\n                1,\n                43,\n                42,\n                30,\n                51,\n                54,\n                83,\n                87,\n                91,\n                1110,\n                1134,\n                1148,\n                1118,\n                6,\n                11,\n                1000,\n                28,\n                29,\n                47,\n                44,\n                76,\n                1103,\n                1158,\n                1107,\n                1133,\n                1160,\n                1129,\n                1149,\n                2,\n                14,\n                26,\n                20,\n                72,\n                90,\n                88,\n                1105,\n                1112,\n                1113,\n                1135,\n                1141,\n                1125,\n                1155,\n                1130,\n                1137,\n                4,\n                24,\n                53,\n                32,\n                46,\n                81,\n                68,\n                85,\n                1119,\n                94,\n                1123,\n                96,\n                1145,\n                1001,\n                1176,\n                23,\n                61,\n                69,\n                63,\n                1104,\n                74,\n                1106,\n                1108,\n                1100,\n                1122,\n                1140,\n                1101,\n                1163,\n                40,\n                1151,\n                45,\n                50,\n                41,\n                80,\n                52,\n                71,\n                99,\n                1132,\n                93,\n                1126,\n                1165,\n                1146,\n                1150,\n                1156,\n                1175,\n                7,\n                3,\n                27,\n                89,\n                97,\n                64,\n                1131,\n                1109,\n                1136,\n                1115,\n                1147,\n                1117,\n                9,\n                19,\n                15,\n                16,\n                60,\n                39,\n                62,\n                73,\n                65,\n                67,\n                79,\n                98,\n                92,\n                1124,\n                1121,\n                1128,\n                1102,\n                1139,\n                1138,\n                1143,\n                1161,\n                1127\n            ],\n            \"id_highlights\": [\n                51933,\n                52276,\n                53477,\n                53691,\n                56268,\n                56370,\n                59257,\n                59925,\n                60038,\n                60251,\n                60318,\n                60441,\n                60929,\n                61395,\n                61680,\n                61761,\n                61925,\n                61935,\n                61976,\n                62013,\n                62036,\n                62217,\n                62258,\n                62357,\n                62380,\n                62421,\n                62498,\n                62539,\n                63097,\n                63836,\n                63857,\n                64663,\n                64756,\n                64805,\n                64806,\n                65297,\n                65337,\n                65376,\n                65379,\n                65416,\n                65436,\n                65456,\n                65468,\n                65475,\n                65601,\n                65710,\n                65823,\n                65857,\n                66245,\n                66600,\n                66601,\n                66623,\n                66632,\n                66633,\n                66725,\n                66758,\n                66849,\n                66905,\n                66979,\n                67099,\n                67214\n            ],\n            \"offerPrice\": 111712.5,\n            \"offerText\": \"25%\",\n            \"offerDescription\": \"¡Aprovecha!\",\n            \"stores_with_offer\": [\n                26,\n                80,\n                53,\n                54,\n                2,\n                4,\n                67,\n                31,\n                20,\n                14,\n                81,\n                39,\n                19,\n                5,\n                79,\n                68,\n                61,\n                60,\n                49,\n                46,\n                42,\n                41,\n                40,\n                37,\n                32,\n                30,\n                29,\n                27,\n                24,\n                23,\n                22,\n                21,\n                18,\n                17,\n                16,\n                15,\n                13,\n                12,\n                11,\n                10,\n                9,\n                7,\n                6,\n                3,\n                83,\n                85,\n                0,\n                86,\n                25,\n                8,\n                99,\n                1112,\n                1122,\n                1135,\n                1115,\n                1141,\n                88,\n                89,\n                1175,\n                43,\n                74,\n                63,\n                50,\n                45,\n                44,\n                47,\n                1102,\n                1136,\n                1147,\n                1127,\n                51,\n                52,\n                62,\n                76,\n                1123,\n                64,\n                72,\n                71,\n                65,\n                1116,\n                69,\n                73,\n                1140,\n                93,\n                94,\n                1104,\n                1105,\n                92,\n                1101,\n                91,\n                1107,\n                1113,\n                1137,\n                96,\n                1156,\n                97,\n                98,\n                1106,\n                1108,\n                1100,\n                1103,\n                1109,\n                1110,\n                1131,\n                1119,\n                1158,\n                1000,\n                1001,\n                1117,\n                1118,\n                1121,\n                1124,\n                1128,\n                1143,\n                1146,\n                1176,\n                1125,\n                1139,\n                1129,\n                1132,\n                95,\n                1134,\n                1133,\n                1130,\n                1151,\n                1160,\n                1161,\n                1163,\n                1165,\n                28,\n                1126\n            ],\n            \"id\": \"263550021\",\n            \"primePrice\": 104265,\n            \"primeTextDiscount\": \"30%\",\n            \"primeDescription\": \"¡Aprovecha!\",\n            \"Prime\": \"si\",\n            \"stores_with_prime_offer\": [\n                26,\n                80,\n                53,\n                54,\n                2,\n                4,\n                67,\n                31,\n                20,\n                14,\n                81,\n                39,\n                19,\n                5,\n                79,\n                68,\n                61,\n                60,\n                49,\n                46,\n                42,\n                41,\n                40,\n                37,\n                32,\n                30,\n                29,\n                27,\n                24,\n                23,\n                22,\n                21,\n                18,\n                17,\n                16,\n                15,\n                13,\n                12,\n                11,\n                10,\n                9,\n                7,\n                6,\n                3,\n                83,\n                85,\n                0,\n                86,\n                25,\n                8,\n                99,\n                1112,\n                1122,\n                1135,\n                1115,\n                1141,\n                88,\n                89,\n                1175,\n                43,\n                74,\n                63,\n                50,\n                45,\n                44,\n                47,\n                1102,\n                1136,\n                1147,\n                1127,\n                51,\n                52,\n                62,\n                76,\n                1123,\n                64,\n                72,\n                71,\n                65,\n                1116,\n                69,\n                73,\n                1140,\n                93,\n                94,\n                1104,\n                1105,\n                92,\n                1101,\n                91,\n                1107,\n                1113,\n                1137,\n                96,\n                1156,\n                97,\n                98,\n                1106,\n                1108,\n                1100,\n                1103,\n                1109,\n                1110,\n                1131,\n                1119,\n                1158,\n                1000,\n                1001,\n                1117,\n                1118,\n                1121,\n                1124,\n                1128,\n                1143,\n                1146,\n                1176,\n                1125,\n                1139,\n                1129,\n                1132,\n                95,\n                1134,\n                1133,\n                1130,\n                1151,\n                1160,\n                1161,\n                1163,\n                1165,\n                28,\n                1126\n            ],\n            \"id_suggested\": [\n                24611\n            ],\n            \"fullPriceByCity\": [\n                {\n                    \"cityCode\": \"VVC\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"ELL\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"ENV\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"TAG\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"MED\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"BUC\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"IDA\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"IRO\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"ALI\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"JIC\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"PAQ\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"LAR\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"CIR\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"ARM\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"GAI\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"SMR\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"GSC\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"LAC\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"AMU\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"BOG\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"CUT\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"VRO\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"SPA\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"DOS\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"PER\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"CHI\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"BAR\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"OMB\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"CTG\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"SOL\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"SOA\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"VUP\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"INI\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"RET\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"ION\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"CTA\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"VLL\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"NIZ\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"TER\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"PIE\",\n                    \"fullPrice\": 148950\n                },\n                {\n                    \"cityCode\": \"NET\",\n                    \"fullPrice\": 148950\n                }\n            ],\n            \"idOffersGroup\": [\n                52088\n            ],\n            \"offerStartDate\": 1746075600000,\n            \"offerEndDate\": 1746507540000,\n            \"lastUpdate\": {\n                \"jobName\": \"UPDATE_SUGGEST\",\n                \"timeStamp\": 1747263900270\n            },\n            \"supplier\": \"GALDERMA MASIVO\",\n            \"grayDescription\": \" \",\n            \"highlight\": \"false\",\n            \"requirePrescription\": \"false\",\n            \"anywaySelling\": false,\n            \"is_cupon\": 0,\n            \"genericos\": 0,\n            \"spaces\": 1,\n            \"url\": \"263550021-crema-facial-cetaphil\",\n            \"status\": \"A\",\n            \"offerPriceByCity\": [],\n            \"RMS_PROVIDER\": \"GALDERMA MASIVO\",\n            \"metatituloSEO\": null,\n            \"metadesSEO\": null,\n            \"urlCanonical\": null,\n            \"customTag\": null,\n            \"desHiddenSEO\": null,\n            \"customLabelForStockZeroByCity\": [\n                {\n                    \"cityCode\": \"BOG\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BOG\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BOG\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BOG\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BAR\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BAR\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BAR\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"SOL\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"SOA\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"SMR\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"CTG\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"VUP\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"ALI\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"ION\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"ION\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"MED\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"MED\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"JIC\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"LAC\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"CTA\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"CUT\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"CUT\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"TER\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"AMU\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"BUC\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"NET\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"ARM\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"PER\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"NIZ\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"PIE\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                },\n                {\n                    \"cityCode\": \"CHI\",\n                    \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                }\n            ],\n            \"_collections\": [\n                \"Test\"\n            ],\n            \"objectID\": \"263550021\"\n        }\n    ]\n}"
	responseOKCatalogProductsByQuery     = "{\n    \"results\": [\n        {\n            \"appliedRules\": null,\n            \"appliedRelevancyStrictness\": 0,\n            \"aroundLatLng\": \"\",\n            \"automaticRadius\": \"\",\n            \"exhaustiveFacetsCount\": true,\n            \"exhaustiveNbHits\": true,\n            \"explain\": null,\n            \"extensions\": {\n                \"queryCategorization\": {}\n            },\n            \"facets\": {},\n            \"facets_stats\": null,\n            \"hits\": [\n                {\n                    \"Prime\": \"\",\n                    \"RMS_PROVIDER\": \"JGB MASIVOS\",\n                    \"_collections\": [],\n                    \"anywaySelling\": false,\n                    \"barcode\": \"7702560043864\",\n                    \"barcodeList\": [\n                        \"220900027\",\n                        \"7702560043864\",\n                        \"07702560043864\"\n                    ],\n                    \"brand\": \"2008M-0008623\",\n                    \"categorie\": \"Cuidado de la piel\",\n                    \"classification\": [\n                        {\n                            \"id\": 72,\n                            \"name\": \"Belleza\",\n                            \"typeId\": 1,\n                            \"typeName\": \"DEPARTAMENTO\"\n                        },\n                        {\n                            \"id\": 83,\n                            \"name\": \"Cuidado de la piel\",\n                            \"typeId\": 2,\n                            \"typeName\": \"CATEGORIA\"\n                        },\n                        {\n                            \"id\": 121,\n                            \"name\": \"Cuidado facial\",\n                            \"typeId\": 3,\n                            \"typeName\": \"SUBCATEGORIA\"\n                        }\n                    ],\n                    \"color\": null,\n                    \"colors\": null,\n                    \"customLabelForStockZero\": \"Pocas unidades | Solo en tiendas\",\n                    \"customLabelForStockZeroByCity\": [\n                        {\n                            \"cityCode\": \"BOG\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BOG\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BOG\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BOG\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BAR\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BAR\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BAR\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"SOL\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"SOA\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"SMR\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"CTG\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"VVC\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"VUP\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"ALI\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"ION\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"ION\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"MED\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"MED\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"MED\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"JIC\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"LAC\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"CTA\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"CUT\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"CUT\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"TER\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"AMU\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"BUC\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"NET\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"ARM\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"PER\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"NIZ\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"PIE\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        },\n                        {\n                            \"cityCode\": \"CHI\",\n                            \"customLabel\": \"Pocas unidades | Solo en tiendas\"\n                        }\n                    ],\n                    \"customTag\": null,\n                    \"deliveryTime\": \"35 min. promedio\",\n                    \"departments\": [\n                        \"Belleza\"\n                    ],\n                    \"desHiddenSEO\": \"\",\n                    \"fullPrice\": 12950,\n                    \"fullPriceByCity\": [\n                        {\n                            \"cityCode\": \"VVC\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"ELL\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"ENV\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"TAG\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"MED\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"BUC\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"IDA\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"IRO\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"ALI\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"JIC\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"PAQ\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"LAR\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"CIR\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"ARM\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"GAI\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"SMR\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"GSC\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"LAC\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"AMU\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"BOG\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"CUT\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"VRO\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"SPA\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"DOS\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"PER\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"BAR\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"OMB\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"CHI\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"CTG\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"SOL\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"VUP\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"SOA\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"CTA\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"INI\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"RET\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"ION\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"VLL\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"NIZ\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"TER\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"PIE\",\n                            \"fullPrice\": 12950\n                        },\n                        {\n                            \"cityCode\": \"NET\",\n                            \"fullPrice\": 12950\n                        }\n                    ],\n                    \"genericos\": 0,\n                    \"grayDescription\": \" \",\n                    \"hasStock\": false,\n                    \"highlight\": \"false\",\n                    \"id\": \"220900027\",\n                    \"idOffersGroup\": [\n                        51918\n                    ],\n                    \"id_highlights\": [\n                        62016,\n                        62537,\n                        62656,\n                        65068,\n                        65072,\n                        65658,\n                        65673,\n                        65709,\n                        65721,\n                        67421\n                    ],\n                    \"id_suggested\": [\n                        24634\n                    ],\n                    \"is_cupon\": 0,\n                    \"labelPum\": \"Unidades a $\",\n                    \"largeDescription\": \"Pads Faciales JGB son 100% Algodón perfectos para todo tipo de piel.\",\n                    \"lastUpdate\": {\n                        \"jobName\": \"UPDATE_STOCK\",\n                        \"timeStamp\": 1749048313443\n                    },\n                    \"listUrlImages\": [\n                        \"https://lh3.googleusercontent.com/2S94WriR-1FmErBtNZJyeFu4cNKOjYn4P0Cvtk93gufm5Pqa_hYypusgTSkzEgakv6NSwWM7gaRAgKlKqscg7cIIXr0kEmKle2noh_J9ICdJTAs0\"\n                    ],\n                    \"marca\": \"JGB\",\n                    \"measurePum\": 50,\n                    \"mediaDescription\": \"Pads Faciales JGB Algodón 100% x 50 und\",\n                    \"mediaImageUrl\": \"https://lh3.googleusercontent.com/qEHz6u5CHhCblpPtgiF53-n7yE9WxCaoLabiNeLL7RnryYIsxaDmlxSDdLTV4SwEp-NmJpGJFu70t4UmMvwaJdpdeUHoGayagRNZZuBGZ_qL7KAN\",\n                    \"metadesSEO\": \"\",\n                    \"metatituloSEO\": \"\",\n                    \"objectID\": \"220900027\",\n                    \"offerDescription\": \"\",\n                    \"offerEndDate\": 1743051540000,\n                    \"offerPrice\": 0,\n                    \"offerPriceByCity\": [],\n                    \"offerStartDate\": 1742446800000,\n                    \"offerText\": \"\",\n                    \"onlyOnline\": false,\n                    \"outofstore\": false,\n                    \"primeDescription\": \"\",\n                    \"primePrice\": 0,\n                    \"primeTextDiscount\": \"\",\n                    \"requirePrescription\": \"false\",\n                    \"rms_class\": \"FACIAL LIMP/DESMAQ\",\n                    \"rms_deparment\": \"CUIDADO FACIAL\",\n                    \"rms_group\": \"CUIDADO DE LA PIEL\",\n                    \"rms_subclass\": \"TOALLAS DESMAQUILLANTES\",\n                    \"sales\": 8980,\n                    \"spaces\": 1,\n                    \"status\": \"A\",\n                    \"stores_with_offer\": [],\n                    \"stores_with_prime_offer\": [],\n                    \"stores_with_stock\": [\n                        22,\n                        1,\n                        43,\n                        30,\n                        42,\n                        83,\n                        51,\n                        54,\n                        1110,\n                        87,\n                        91,\n                        1134,\n                        1118,\n                        1148,\n                        11,\n                        6,\n                        1000,\n                        29,\n                        28,\n                        76,\n                        47,\n                        44,\n                        1103,\n                        1158,\n                        1107,\n                        1133,\n                        1129,\n                        1160,\n                        14,\n                        1149,\n                        2,\n                        26,\n                        20,\n                        72,\n                        31,\n                        90,\n                        88,\n                        1105,\n                        1112,\n                        1113,\n                        1135,\n                        1141,\n                        1125,\n                        1130,\n                        1137,\n                        1155,\n                        4,\n                        24,\n                        53,\n                        46,\n                        32,\n                        68,\n                        85,\n                        81,\n                        94,\n                        1119,\n                        1123,\n                        1145,\n                        96,\n                        1001,\n                        1176,\n                        1162,\n                        23,\n                        37,\n                        61,\n                        63,\n                        69,\n                        74,\n                        1104,\n                        1106,\n                        1100,\n                        1101,\n                        1122,\n                        1108,\n                        1163,\n                        1140,\n                        1151,\n                        45,\n                        40,\n                        41,\n                        71,\n                        52,\n                        50,\n                        93,\n                        99,\n                        80,\n                        1132,\n                        1165,\n                        1146,\n                        1116,\n                        1150,\n                        1126,\n                        3,\n                        1175,\n                        1156,\n                        7,\n                        27,\n                        64,\n                        89,\n                        1136,\n                        97,\n                        1109,\n                        1147,\n                        1117,\n                        1131,\n                        1115,\n                        9,\n                        16,\n                        15,\n                        39,\n                        60,\n                        19,\n                        65,\n                        62,\n                        67,\n                        79,\n                        73,\n                        92,\n                        98,\n                        1102,\n                        1121,\n                        1124,\n                        1138,\n                        1128,\n                        1143,\n                        1161,\n                        1127,\n                        1139\n                    ],\n                    \"subCategory\": \"Cuidado facial\",\n                    \"supplier\": \"JGB MASIVOS\",\n                    \"taxRate\": 19,\n                    \"url\": null,\n                    \"urlCanonical\": \"\"\n                }\n            ],\n            \"hitsPerPage\": 1,\n            \"index\": \"\",\n            \"indexUsed\": \"\",\n            \"length\": 0,\n            \"message\": \"\",\n            \"nbHits\": 2411,\n            \"nbPages\": 1000,\n            \"nbSortedHits\": 0,\n            \"offset\": 0,\n            \"page\": 0,\n            \"params\": \"clickAnalytics=true&facets=%5B%22%22%5D&filters=departments%3A%27Belleza%27+AND+outofstore%3Afalse+AND+stores_with_stock%3A26&hitsPerPage=1&optionalFilters=%5B%5B%22%22%5D%5D&page=0&query=&userToken=\",\n            \"parsedQuery\": \"\",\n            \"processingTimeMS\": 2,\n            \"query\": \"\",\n            \"queryAfterRemoval\": \"\",\n            \"queryID\": \"5b9c73ed1fa5552f62c9dfd3cd669498\",\n            \"serverUsed\": \"\",\n            \"timeoutCounts\": false,\n            \"timeoutHits\": false,\n            \"userData\": null,\n            \"abTestVariantID\": 0,\n            \"abTestID\": 0,\n            \"renderingContent\": {}\n        }\n    ]\n}"
	urlCatalogProductMockForArgentina    = "/1/indexes/products-argentina/123"
	urlCatalogProductByObjectsIDMock     = "/1/indexes/*/objects"
	urlCatalogProductByQueryMock         = "/1/indexes/*/queries"
)

var (
	products = []string{"263550021", "3499320014540", "03499320014540"}
	params   = "hitsPerPage=20&filters=departments:'Belleza' AND outofstore:false AND stores_with_stock:26&page=0&clickAnalytics=true&enablePersonalization=true"
)

func Test_GetProductInformationWhenSuccess(t *testing.T) {
	controller := gomock.NewController(t)
	defer controller.Finish()

	// Usar la URL correcta para el mock de Argentina
	server := mocks_server.ConfigMockSrver(responseOKCatalogProducts,
		urlCatalogProductMockForArgentina, http.MethodGet, http.StatusOK, "{}")

	defer server.Close()

	config.Enviroments.CatalogProductsUrl = server.URL

	gin.SetMode(gin.TestMode)

	ctx, _ := gin.CreateTestContext(httptest.NewRecorder())
	ctx.Request = &http.Request{Header: make(http.Header), URL: &url.URL{}}

	ctx.Set("X-Correlation-ID", "1291823jhau1uha")

	httpCatalogProduct := NewCatalogProduct()

	data, err := httpCatalogProduct.GetProductInformation(ctx, "123")

	assert.NoError(t, err)
	assert.Equal(t, data.Brand, "2008M-0008623")
}

func Test_GetProductsInformationByObjectIDWhenSuccess(t *testing.T) {
	controller := gomock.NewController(t)
	defer controller.Finish()

	server := mocks_server.ConfigMockSrver(responseOKCatalogProductsByObjectsID,
		urlCatalogProductByObjectsIDMock, http.MethodPost, http.StatusOK, "{}")

	defer server.Close()

	config.Enviroments.CatalogProductsUrl = server.URL

	gin.SetMode(gin.TestMode)

	ctx, _ := gin.CreateTestContext(httptest.NewRecorder())
	ctx.Request = &http.Request{Header: make(http.Header), URL: &url.URL{}}

	ctx.Set("X-Correlation-ID", "1291823jhau1uha")

	httpCatalogProduct := NewCatalogProduct()

	data, err := httpCatalogProduct.GetProductsInformationByObjectID(ctx, products, "CO")

	assert.NoError(t, err)
	assert.Equal(t, data[0].Brand, "2008M-0008623")
}

func Test_GetProductsInformationByQueryWhenSuccess(t *testing.T) {
	controller := gomock.NewController(t)
	defer controller.Finish()

	server := mocks_server.ConfigMockSrver(responseOKCatalogProductsByQuery,
		urlCatalogProductByQueryMock, http.MethodPost, http.StatusOK, "{}")

	defer server.Close()

	config.Enviroments.CatalogProductsUrl = server.URL

	gin.SetMode(gin.TestMode)

	ctx, _ := gin.CreateTestContext(httptest.NewRecorder())
	ctx.Request = &http.Request{Header: make(http.Header), URL: &url.URL{}}

	ctx.Set("X-Correlation-ID", "1291823jhau1uha")

	httpCatalogProduct := NewCatalogProduct()

	data, err := httpCatalogProduct.GetProductsInformationByQuery(ctx, params, "CO")

	assert.NoError(t, err)
	assert.Equal(t, data[0].Brand, "2008M-0008623")
}
